{% extends "base.html" %}
{% block content %}

<h2 style="text-align:center;">Your Friends</h2>

<form method="post" style="margin-bottom: 20px; text-align:center;">
    <label>Add Friend (username):</label>
    <input type="text" name="friend" required>
    <button class="btn" type="submit">Send Request</button>
</form>

{% if message %}
<p style="color: green; text-align:center;">{{ message }}</p>
{% endif %}
{% if error %}
<p style="color: red; text-align:center;">{{ error }}</p>
{% endif %}

<!-- ========== FRIEND REQUESTS SECTION ========== -->
<h3 style="text-align:center;">Friend Requests</h3>

{% if incoming_requests and incoming_requests|length > 0 %}
<ul style="margin-bottom: 20px; list-style:none; padding:0; text-align:center;">
    {% for sender in incoming_requests %}
    <li style="margin-bottom: 15px;">

        <b>{{ USER_FULLNAME.get(sender, sender) }}</b><br>
        <small style="color:#666;">(@{{ sender }})</small><br><br>

        <form method="post" action="{{ url_for('accept_friend', sender=sender) }}" style="display:inline;">
            <button class="btn btn-success btn-sm" type="submit">Accept</button>
        </form>

        <form method="post" action="{{ url_for('decline_friend', sender=sender) }}" style="display:inline;">
            <button class="btn btn-secondary btn-sm" type="submit">Decline</button>
        </form>

    </li>
    {% endfor %}
</ul>
{% else %}
<p style="text-align:center;"><i>No pending friend requests.</i></p>
{% endif %}

<hr>

<!-- ========== CURRENT FRIENDS ========== -->
<h3 style="text-align:center;">Current Friends</h3>

<table style="width:100%; text-align:center;">
    <tr>
        <th style="text-align:center;">Friend</th>
        <th style="text-align:center;">Status</th>
    </tr>

    {% for f in friends %}
    <tr>
        <td style="padding:14px;">
            <div style="display:flex; align-items:center; justify-content:center; gap:14px;">

                {% if f.pic %}
                <img src="{{ url_for('static', filename='uploads/' ~ f.pic) }}"
                     style="width:45px; height:45px; border-radius:50%; object-fit:cover;">
                {% else %}
                <img src="{{ url_for('static', filename='default_profile.png') }}"
                     style="width:45px; height:45px; border-radius:50%; object-fit:cover;">
                {% endif %}

                <div style="text-align:left;">
                    <b style="font-size:15px;">{{ f.fullname }}</b><br>
                    <span style="font-size:12px; color:#777;">(@{{ f.name }})</span>
                </div>

            </div>
        </td>

        <td style="padding:10px;">
            <span class="status-dot status-{{ f.status }}"></span>
            {{ f.status|capitalize }}
        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
